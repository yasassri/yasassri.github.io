<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Generate Active AWS EC2 Instance Report" /><meta property="og:locale" content="en" /><meta name="description" content="When sing AWS for running instance it’s important that we keep an eye on the running instances in-order to manage your cost. In most cases…" /><meta property="og:description" content="When sing AWS for running instance it’s important that we keep an eye on the running instances in-order to manage your cost. In most cases…" /><link rel="canonical" href="https://yasassri.github.io/posts/GenerateActiveAWSEC2InstanceReport/" /><meta property="og:url" content="https://yasassri.github.io/posts/GenerateActiveAWSEC2InstanceReport/" /><meta property="og:site_name" content="Yasassri Ratnayake" /><meta property="og:image" content="https://yasassri.github.io/assets/img/medium/0__Mgvcsevtq9ZbvROi.jpg" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-12-17T09:28:33-05:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://yasassri.github.io/assets/img/medium/0__Mgvcsevtq9ZbvROi.jpg" /><meta property="twitter:title" content="Generate Active AWS EC2 Instance Report" /><meta name="twitter:site" content="@yasassrir" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-04T16:22:38-04:00","datePublished":"2018-12-17T09:28:33-05:00","description":"When sing AWS for running instance it’s important that we keep an eye on the running instances in-order to manage your cost. In most cases…","headline":"Generate Active AWS EC2 Instance Report","image":{"width":800,"height":500,"alt":null,"url":"https://yasassri.github.io/assets/img/medium/0__Mgvcsevtq9ZbvROi.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yasassri.github.io/posts/GenerateActiveAWSEC2InstanceReport/"},"url":"https://yasassri.github.io/posts/GenerateActiveAWSEC2InstanceReport/"}</script><title>Generate Active AWS EC2 Instance Report | Yasassri Ratnayake</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Yasassri Ratnayake"><meta name="application-name" content="Yasassri Ratnayake"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-512x512.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Yasassri Ratnayake</a></div><div class="site-subtitle font-italic">My Personal Web Space</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/otherblogs/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>OTHER BLOGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yasassri" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://stackoverflow.com/users/2627018/ycr" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.linkedin.com/in/yasassriratnayake" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ycrnet','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Generate Active AWS EC2 Instance Report</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Generate Active AWS EC2 Instance Report</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1545056913" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 17, 2018 </em> </span> <span> Updated <em class="" data-ts="1656966158" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 4, 2022 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/medium/0__Mgvcsevtq9ZbvROi.jpg" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/yasassri">Yasassri Ratnayake</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="881 words"> <em>4 min</em> read</span></div></div></div><div class="post-content"><p>When sing AWS for running instance it’s important that we keep an eye on the running instances in-order to manage your cost. In most cases you will forget that you have started an instance to run your tests and It will run unnecessarily till you notice it. So in this pose I will explain how we can generate a simple Email everyday with the instances that are running. I will be using AWS SDK for this.</p><p>Prerequisits : aws cli configured in your machine.</p><p>Lets get started, So the final outcome will be something like below,</p><p><img data-src="/assets/img/medium/1__0v1AFp__4bkMUWQXPtGsvJw.png" alt="" data-proofer-ignore></p><p>I will be generating an html report As you can see I have highlighted the instances that are running more than 2 hours. Also it captures information like Intance Name, ID, State, Instance Type, Started time, Associated stack and uptime. So following is the simple code segment that I have used.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">org.ycr.aws</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.amazonaws.services.ec2.AmazonEC2</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.ec2.AmazonEC2ClientBuilder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.ec2.model.DescribeInstancesRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.ec2.model.DescribeInstancesResult</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.ec2.model.Instance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.ec2.model.Reservation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.amazonaws.services.ec2.model.Tag</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.BufferedWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">StringBuilder</span> <span class="n">tempalte</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="c1">// Excludes any permanently running instances from the report</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">excludeIdList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="n">excludeIdList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"i-0e637e411a26a3cd4"</span><span class="o">);</span>
        <span class="n">excludeIdList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"i-0f978eabef81c5b20"</span><span class="o">);</span>
        
        <span class="n">tempalte</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&lt;!DOCTYPE html&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"&lt;html&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"&lt;head&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"&lt;/head&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"&lt;body&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"\n"</span> <span class="o">+</span>
                        <span class="s">"&lt;table id=\"customers\" border=\"1\" style=\"font-family: \"Trebuchet MS\", Arial, Helvetica, sans-serif; width: 100%;\"&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"  &lt;tr&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"    &lt;th&gt;Instance Name&lt;/th&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"    &lt;th&gt;Instance ID&lt;/th&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"    &lt;th&gt;State&lt;/th&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"    &lt;th&gt;Instance Type&lt;/th&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"    &lt;th&gt;Started Time Stamp&lt;/th&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"    &lt;th&gt;Associated Stack&lt;/th&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"    &lt;th&gt;Uptime(Hours)&lt;/th&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"  &lt;/tr&gt;\n"</span><span class="o">);</span>
        <span class="kd">final</span> <span class="nc">AmazonEC2</span> <span class="n">ec2</span> <span class="o">=</span> <span class="nc">AmazonEC2ClientBuilder</span><span class="o">.</span><span class="na">defaultClient</span><span class="o">();</span>
        <span class="kt">boolean</span> <span class="n">done</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="kt">boolean</span> <span class="n">runningInstancesAvailable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>

        <span class="nc">DescribeInstancesRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DescribeInstancesRequest</span><span class="o">();</span>
        <span class="k">while</span> <span class="o">(!</span><span class="n">done</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">DescribeInstancesResult</span> <span class="n">response</span> <span class="o">=</span> <span class="n">ec2</span><span class="o">.</span><span class="na">describeInstances</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>

            <span class="k">for</span> <span class="o">(</span><span class="nc">Reservation</span> <span class="n">reservation</span> <span class="o">:</span> <span class="n">response</span><span class="o">.</span><span class="na">getReservations</span><span class="o">())</span> <span class="o">{</span>
                <span class="kt">boolean</span> <span class="n">exclude</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="nc">Instance</span> <span class="n">instance</span> <span class="o">:</span> <span class="n">reservation</span><span class="o">.</span><span class="na">getInstances</span><span class="o">())</span> <span class="o">{</span>
                    <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">id</span> <span class="o">:</span> <span class="n">excludeIdList</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">id</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">instance</span><span class="o">.</span><span class="na">getInstanceId</span><span class="o">()))</span> <span class="o">{</span>
                            <span class="n">exclude</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                            <span class="k">break</span><span class="o">;</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">(!</span><span class="n">exclude</span><span class="o">)</span> <span class="o">{</span>
                        <span class="c1">// Here I'm excluding instances that are t2.micro since they are included in the free tier.</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">instance</span><span class="o">.</span><span class="na">getState</span><span class="o">().</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"running"</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">instance</span><span class="o">.</span><span class="na">getInstanceType</span><span class="o">().</span><span class="na">equals</span>
                                <span class="o">(</span><span class="s">"t2.micro"</span><span class="o">))</span> <span class="o">{</span>
                            <span class="n">runningInstancesAvailable</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
                            <span class="c1">// Get the insatance name</span>
                            <span class="nc">String</span> <span class="n">instanceName</span> <span class="o">=</span> <span class="s">"Unknown"</span><span class="o">;</span>
                            <span class="nc">String</span> <span class="n">stackName</span> <span class="o">=</span> <span class="s">"No Stack!"</span><span class="o">;</span>
                            
                            <span class="c1">// Iterating over the tags to find information ike stack name and instance name</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">instance</span><span class="o">.</span><span class="na">getTags</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                                <span class="k">for</span> <span class="o">(</span><span class="nc">Tag</span> <span class="n">tag</span> <span class="o">:</span> <span class="n">instance</span><span class="o">.</span><span class="na">getTags</span><span class="o">())</span> <span class="o">{</span>
                                    <span class="k">if</span> <span class="o">(</span><span class="n">tag</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"Name"</span><span class="o">))</span> <span class="o">{</span>
                                        <span class="n">instanceName</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                                        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Instance Name : "</span> <span class="o">+</span> <span class="n">instanceName</span><span class="o">);</span>
                                    <span class="o">}</span>
                                    <span class="k">if</span> <span class="o">(</span><span class="n">tag</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"aws:cloudformation:stack-name"</span><span class="o">)){</span>
                                        <span class="n">stackName</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                                    <span class="o">}</span>
                                <span class="o">}</span>
                            <span class="o">}</span>
                            <span class="c1">// Calculating the uptime</span>
                            <span class="kt">long</span> <span class="n">uptime</span> <span class="o">=</span> <span class="n">getDateDiff</span><span class="o">(</span><span class="n">instance</span><span class="o">.</span><span class="na">getLaunchTime</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">(),</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">HOURS</span><span class="o">);</span>
                            <span class="c1">// If the uptime is more than 2 hours highlighting the text.</span>
                            <span class="k">if</span> <span class="o">(</span><span class="n">uptime</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                                <span class="n">tempalte</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"  &lt;tr style=\"color: #f71313; font-weight:bold\"&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instanceName</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getInstanceId</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getState</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getInstanceType</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getLaunchTime</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">stackName</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td style=\"text-align:center\"&gt;"</span> <span class="o">+</span> <span class="n">uptime</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"  &lt;/tr&gt;\n"</span><span class="o">);</span>

                            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                                <span class="n">tempalte</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"  &lt;tr&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instanceName</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getInstanceId</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getState</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getInstanceType</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">instance</span><span class="o">.</span><span class="na">getLaunchTime</span><span class="o">().</span><span class="na">toString</span><span class="o">()</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td&gt;"</span> <span class="o">+</span> <span class="n">stackName</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"    &lt;td style=\"text-align:center\"&gt;"</span> <span class="o">+</span> <span class="n">uptime</span> <span class="o">+</span> <span class="s">"&lt;/td&gt;\n"</span> <span class="o">+</span>
                                                <span class="s">"  &lt;/tr&gt;\n"</span><span class="o">);</span>
                            <span class="o">}</span>

                            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span>
                                    <span class="s">"Found instance with id %s, "</span> <span class="o">+</span>
                                    <span class="s">"AMI %s, "</span> <span class="o">+</span>
                                    <span class="s">"type %s, "</span> <span class="o">+</span>
                                    <span class="s">"state %s "</span> <span class="o">+</span>
                                    <span class="s">"and monitoring state %s"</span><span class="o">,</span>
                                    <span class="n">instance</span><span class="o">.</span><span class="na">getInstanceId</span><span class="o">(),</span>
                                    <span class="n">instance</span><span class="o">.</span><span class="na">getImageId</span><span class="o">(),</span>
                                    <span class="n">instance</span><span class="o">.</span><span class="na">getInstanceType</span><span class="o">(),</span>
                                    <span class="n">instance</span><span class="o">.</span><span class="na">getState</span><span class="o">().</span><span class="na">getName</span><span class="o">(),</span>
                                    <span class="n">instance</span><span class="o">.</span><span class="na">getMonitoring</span><span class="o">().</span><span class="na">getState</span><span class="o">());</span>
                        <span class="o">}</span>
                        <span class="n">instance</span><span class="o">.</span><span class="na">getKeyName</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">request</span><span class="o">.</span><span class="na">setNextToken</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getNextToken</span><span class="o">());</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getNextToken</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">done</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">tempalte</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"&lt;/table&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"&lt;/body&gt;\n"</span> <span class="o">+</span>
                        <span class="s">"&lt;/html&gt;"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tempalte</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">runningInstancesAvailable</span><span class="o">){</span>
            <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"./mail.html"</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">(</span><span class="nc">BufferedWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileWriter</span><span class="o">(</span><span class="n">file</span><span class="o">)))</span> <span class="o">{</span>
                <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">tempalte</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                <span class="n">writer</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * Get a diff between two dates
     * @param date1 the oldest date
     * @param date2 the newest date
     * @param timeUnit the unit in which you want the diff
     * @return the diff value, in the provided unit
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">long</span> <span class="nf">getDateDiff</span><span class="o">(</span><span class="nc">Date</span> <span class="n">date1</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">date2</span><span class="o">,</span> <span class="nc">TimeUnit</span> <span class="n">timeUnit</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">diffInMillies</span> <span class="o">=</span> <span class="n">date2</span><span class="o">.</span><span class="na">getTime</span><span class="o">()</span> <span class="o">-</span> <span class="n">date1</span><span class="o">.</span><span class="na">getTime</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">timeUnit</span><span class="o">.</span><span class="na">convert</span><span class="o">(</span><span class="n">diffInMillies</span><span class="o">,</span><span class="nc">TimeUnit</span><span class="o">.</span><span class="na">MILLISECONDS</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>You can find the full project from here (<a href="https://github.com/yasassri/aws-observer">https://github.com/yasassri/aws-observer</a>). You can simply do an <em>mvn clean install</em> to generate the html content. Please drop a comment if you have any queries.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/devops/'>Devops</a>, <a href='/categories/aws/'>AWS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/automation/" class="post-tag no-text-decoration" >automation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Generate+Active+AWS+EC2+Instance+Report+-+Yasassri+Ratnayake&url=https%3A%2F%2Fyasassri.github.io%2Fposts%2FGenerateActiveAWSEC2InstanceReport%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Generate+Active+AWS+EC2+Instance+Report+-+Yasassri+Ratnayake&u=https%3A%2F%2Fyasassri.github.io%2Fposts%2FGenerateActiveAWSEC2InstanceReport%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fyasassri.github.io%2Fposts%2FGenerateActiveAWSEC2InstanceReport%2F&text=Generate+Active+AWS+EC2+Instance+Report+-+Yasassri+Ratnayake" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/TrackStateOfIntegrationsInWSO2MI/">Building a Thread-Safe State Tracker Mediator for WSO2</a><li><a href="/posts/OverrridingjavaOptionsInjectedToJavaProcesses/">Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library</a><li><a href="/posts/Delaying-Container-startup-until-a-Kubernetes-resources-are-created/">Delaying Application Startup Until Kubernetes Resources are Created</a><li><a href="/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/">Converting Java CLI Client to a Native Executable with GraalVM</a><li><a href="/posts/Keeping-Your-WSO2-Products-up-to-date-in-a-ContainerisedEnv/">Keeping Your WSO2 Products up-to-date in a Containerised Environment</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/wso2/">wso2</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/cicd/">cicd</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/jenkins/">jenkins</a> <a class="post-tag" href="/tags/wso2/">WSO2</a> <a class="post-tag" href="/tags/wso2mi/">wso2mi</a> <a class="post-tag" href="/tags/groovy/">groovy</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Manage-WSO2-Carbon-Applications-Remotely/"><div class="card-body"> <em class="small" data-ts="1588047139" data-df="ll" > Apr 28, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Manage WSO2 Carbon Applications Remotely.</h3><div class="text-muted small"><p> In this post I’ll introduce you to a Java CLI client that I happened to write to manage WSO2 Carbon Applications. WSO2 Enterprise Integrator (was known as WSO2 ESB) has a mechanism to develop integ...</p></div></div></a></div><div class="card"> <a href="/posts/EmpoweringTeamsBuildinganntegrationMashupasaServicewithWSO2MI/"><div class="card-body"> <em class="small" data-ts="1608543730" data-df="ll" > Dec 21, 2020 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Empowering your Teams; Building an Integration Mashup as a Service with WSO2 MI</h3><div class="text-muted small"><p> In medium-scale to large-scale corporations, there are numerous teams/business-units that operate cohesively yet independently to drive the organization towards its’ goals and objectives. These tea...</p></div></div></a></div><div class="card"> <a href="/posts/AuthorizationHandlerForWSO2MI/"><div class="card-body"> <em class="small" data-ts="1654401600" data-df="ll" > Jun 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Role Based Authorization Hanlder for WSO2 Micro Integrator</h3><div class="text-muted small"><p> WSO2 Micro Integrator(MI) is a lightweight integration platform that allows you to write different integrations to connect systems just like an Enterprise Service Bus. If you are familiar with the ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CreateA-JenkinsJobwithaGroovyScript/" class="btn btn-outline-primary" prompt="Older"><p>Create A Jenkins Job with a Groovy Script</p></a> <a href="/posts/Parsing-data-between-Jenkins-Jobs/" class="btn btn-outline-primary" prompt="Newer"><p>Parsing data between Jenkins Jobs</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "yasassri/yasassri.github.io", "data-repo-id": "R_kgDOHmz8Lw", "data-category": "comments", "data-category-id": "DIC_kwDOHmz8L84CRzO5", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/yasassri">Yasassri Ratnayake</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/wso2/">wso2</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/cicd/">cicd</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/jenkins/">jenkins</a> <a class="post-tag" href="/tags/wso2/">WSO2</a> <a class="post-tag" href="/tags/wso2mi/">wso2mi</a> <a class="post-tag" href="/tags/groovy/">groovy</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-0LZHF72L8B"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-0LZHF72L8B'); }); </script>
