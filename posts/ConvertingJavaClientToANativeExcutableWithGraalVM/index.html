<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Converting Java CLI Client to a Native Executable with GraalVM" /><meta property="og:locale" content="en" /><meta name="description" content="Converting Java CLI Client to a Native Executable with GraalVM" /><meta property="og:description" content="Converting Java CLI Client to a Native Executable with GraalVM" /><link rel="canonical" href="https://yasassri.github.io/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/" /><meta property="og:url" content="https://yasassri.github.io/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/" /><meta property="og:site_name" content="Yasassri Ratnayake" /><meta property="og:image" content="https://yasassri.github.io/assets/img/posts/GraalVM.png" /><meta property="og:image:height" content="500" /><meta property="og:image:width" content="800" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-10-16T00:00:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://yasassri.github.io/assets/img/posts/GraalVM.png" /><meta property="twitter:title" content="Converting Java CLI Client to a Native Executable with GraalVM" /><meta name="twitter:site" content="@yasassrir" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-09-16T20:50:51-04:00","datePublished":"2022-10-16T00:00:00-04:00","description":"Converting Java CLI Client to a Native Executable with GraalVM","headline":"Converting Java CLI Client to a Native Executable with GraalVM","image":{"width":800,"height":500,"alt":null,"url":"https://yasassri.github.io/assets/img/posts/GraalVM.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yasassri.github.io/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/"},"url":"https://yasassri.github.io/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/"}</script><title>Converting Java CLI Client to a Native Executable with GraalVM | Yasassri Ratnayake</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Yasassri Ratnayake"><meta name="application-name" content="Yasassri Ratnayake"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-512x512.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Yasassri Ratnayake</a></div><div class="site-subtitle font-italic">My Personal Web Space</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/otherblogs/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>OTHER BLOGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yasassri" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://stackoverflow.com/users/2627018/ycr" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.linkedin.com/in/yasassriratnayake" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ycrnet','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Converting Java CLI Client to a Native Executable with GraalVM</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Converting Java CLI Client to a Native Executable with GraalVM</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1665892800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 16, 2022 </em> </span> <span> Updated <em class="" data-ts="1694911851" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 16, 2023 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 500'%3E%3C/svg%3E" data-src="/assets/img/posts/GraalVM.png" class="preview-img bg" alt="Preview Image" width="800" height="500" data-proofer-ignore></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/yasassri">Yasassri Ratnayake</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1550 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>GraalVM is a high-performance JDK distribution designed to accelerate the execution of applications written in Java and other JVM languages along with support for JavaScript, Ruby, Python, and a number of other popular languages. GrallVM allows you to compile your Java code into native executables which allows you to run them without a JRE. So in this post, I’ll explain the steps I followed to get my CLI client to work with GraalVM.</p><p>Some background, my CLI client was kind of a legacy application that wrapped a couple of SOAP services. Hence its dependencies required components like Axis2, Axiom, log4j etc. Initially, I used <code class="language-plaintext highlighter-rouge">args4j</code> for interactive CLI inputs and the Maven shade plugin to build an executable uber Jar.</p><p>There are a couple of ways to set up and use GraalVMs <code class="language-plaintext highlighter-rouge">native-image</code>. You can use the GraalVM Docker images, or you can simply install GraalVM on your machine. If you are super lazy you can also use Github Actions workflow with <a href="https://github.com/marketplace/actions/github-action-for-graalvm">GraalVM setup step</a>. But I highly recommend using the Docker image or setting it up locally which will save a lot of time when debugging issues. For this, you can refer the official <a href="https://www.graalvm.org/java/quickstart/">Installation Guide</a></p><p>The first try, I thought it was super easy. So I had my Uber Jar created and I simply executed the below, thinking everything would work.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>native-image <span class="nt">-jar</span> capp-manager.jar
</pre></table></code></div></div><p>At least some success, with no errors when converting to a native image.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>Top 10 packages <span class="k">in </span>code area:                               Top 10 object types <span class="k">in </span>image heap:
 663.86KB java.util                                          947.79KB byte[] <span class="k">for </span>code metadata
 351.87KB java.lang                                          897.25KB java.lang.String
 273.76KB java.text                                          837.11KB byte[] <span class="k">for </span>general heap data
 234.86KB java.util.regex                                    628.55KB java.lang.Class
 198.40KB com.oracle.svm.jni                                 544.92KB byte[] <span class="k">for </span>java.lang.String
 193.86KB java.util.concurrent                               434.86KB java.util.HashMap<span class="nv">$Node</span>
 146.93KB java.math                                          224.30KB com.oracle.svm.core.hub.DynamicHubCompanion
 120.62KB java.lang.invoke                                   209.58KB java.util.HashMap<span class="nv">$Node</span><span class="o">[]</span>
 105.90KB com.oracle.svm.core.genscavenge                    164.34KB java.lang.String[]
  98.16KB java.util.logging                                  155.81KB java.util.concurrent.ConcurrentHashMap<span class="nv">$Node</span>
   1.98MB <span class="k">for </span>119 more packages                                1.54MB <span class="k">for </span>786 more object types
<span class="nt">------------------------------------------------------------------------------------------------------------------------</span>
                        0.3s <span class="o">(</span>2.0% of total <span class="nb">time</span><span class="o">)</span> <span class="k">in </span>17 GCs | Peak RSS: 3.30GB | CPU load: 8.23
<span class="nt">------------------------------------------------------------------------------------------------------------------------</span>
Produced artifacts:
 /home/yasassri/workspace/projects/capp-manager/wso2-capp-manager/target/capp-manager-0.1.3 <span class="o">(</span>executable<span class="o">)</span>
 /home/yasassri/workspace/projects/capp-manager/wso2-capp-manager/target/capp-manager-0.1.3.build_artifacts.txt <span class="o">(</span>txt<span class="o">)</span>
<span class="o">========================================================================================================================</span>
Finished generating <span class="s1">'capp-manager-0.1.3'</span> <span class="k">in </span>14.0s.
Warning: Image <span class="s1">'capp-manager-0.1.3'</span> is a fallback image that requires a JDK <span class="k">for </span>execution <span class="o">(</span>use <span class="nt">--no-fallback</span> to suppress fallback image generation and to print more detailed information why a fallback image was necessary<span class="o">)</span><span class="nb">.</span>
</pre></table></code></div></div><p>Although there were no errors, there was a fishy warning at the end, but let’s move the executable to a different location and run it. Bummer, the first error.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>Error: Could not find or load main class org.wso2.capp.client.Main
Caused by: java.lang.ClassNotFoundException: org.wso2.capp.client.Main
</pre></table></code></div></div><p>The reason is the last Warning, for some weird reason the default behavior of <code class="language-plaintext highlighter-rouge">native-image</code> command is to create a fallback image, which means if the executable fails it will execute the Jar as a fallback measure. So this Jar needs a JVM to run. This doesn’t make any sense as to why they have this behavior by default, given the whole purpose of converting to a native image is to run the native image without a JVM. But I found there are legal reasons for Oracle to have this built this way. If interested you can read more from <a href="https://github.com/oracle/GraalVM/issues/2648">here</a></p><p>So let’s add the <code class="language-plaintext highlighter-rouge">--no-fallback</code> flag and create the image, which will stop creating the fallback image and pack everything into the native image.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>native-image <span class="nt">-jar</span> capp-manager.jar <span class="nt">--no-fallback</span>
</pre></table></code></div></div><p>The output</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="nt">------------------------------------------------------------------------------------------------------------------------</span>
Top 10 packages <span class="k">in </span>code area:                               Top 10 object types <span class="k">in </span>image heap:
 706.01KB java.util                                            1.06MB byte[] <span class="k">for </span>code metadata
 370.62KB java.lang                                          980.19KB java.lang.String
 274.10KB java.text                                          887.39KB byte[] <span class="k">for </span>general heap data
 234.89KB java.util.regex                                    773.05KB java.lang.Class
 204.67KB java.util.concurrent                               648.69KB byte[] <span class="k">for </span>java.lang.String
 202.26KB com.oracle.svm.jni                                 435.38KB java.util.HashMap<span class="nv">$Node</span>
 146.93KB java.math                                          282.73KB com.oracle.svm.core.hub.DynamicHubCompanion
 119.09KB java.lang.invoke                                   210.28KB java.util.HashMap<span class="nv">$Node</span><span class="o">[]</span>
 105.90KB com.oracle.svm.core.genscavenge                    176.99KB java.lang.String[]
  98.30KB java.util.logging                                  155.81KB java.util.concurrent.ConcurrentHashMap<span class="nv">$Node</span>
   2.50MB <span class="k">for </span>152 more packages                                1.60MB <span class="k">for </span>829 more object types
<span class="nt">------------------------------------------------------------------------------------------------------------------------</span>
                        0.4s <span class="o">(</span>2.3% of total <span class="nb">time</span><span class="o">)</span> <span class="k">in </span>18 GCs | Peak RSS: 3.47GB | CPU load: 7.80
<span class="nt">------------------------------------------------------------------------------------------------------------------------</span>
Produced artifacts:
 /home/yasassri/workspace/projects/capp-manager/wso2-capp-manager/target/capp-manager-0.1.3 <span class="o">(</span>executable<span class="o">)</span>
 /home/yasassri/workspace/projects/capp-manager/wso2-capp-manager/target/capp-manager-0.1.3.build_artifacts.txt <span class="o">(</span>txt<span class="o">)</span>
<span class="o">========================================================================================================================</span>
</pre></table></code></div></div><p>No Warning this time, so let’s execute it. Once executed I got another error.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>Exception <span class="k">in </span>thread <span class="s2">"main"</span> java.lang.ExceptionInInitializerError
	at org.apache.logging.log4j.LogManager.&lt;clinit&gt;<span class="o">(</span>LogManager.java:61<span class="o">)</span>
	at org.wso2.capp.client.Main.&lt;clinit&gt;<span class="o">(</span>Main.java:14<span class="o">)</span>
Caused by: java.lang.IllegalStateException: java.lang.InstantiationException: org.apache.logging.log4j.message.DefaultFlowMessageFactory
	at org.apache.logging.log4j.spi.AbstractLogger.createDefaultFlowMessageFactory<span class="o">(</span>AbstractLogger.java:246<span class="o">)</span>
	at org.apache.logging.log4j.spi.AbstractLogger.&lt;init&gt;<span class="o">(</span>AbstractLogger.java:144<span class="o">)</span>
	at org.apache.logging.log4j.status.StatusLogger.&lt;init&gt;<span class="o">(</span>StatusLogger.java:105<span class="o">)</span>
	at org.apache.logging.log4j.status.StatusLogger.&lt;clinit&gt;<span class="o">(</span>StatusLogger.java:85<span class="o">)</span>
	... 2 more
Caused by: java.lang.InstantiationException: org.apache.logging.log4j.message.DefaultFlowMessageFactory
	at java.lang.Class.newInstance<span class="o">(</span>DynamicHub.java:639<span class="o">)</span>
	at org.apache.logging.log4j.spi.AbstractLogger.createDefaultFlowMessageFactory<span class="o">(</span>AbstractLogger.java:244<span class="o">)</span>
	... 5 more
Caused by: java.lang.NoSuchMethodException: org.apache.logging.log4j.message.DefaultFlowMessageFactory.&lt;init&gt;<span class="o">()</span>
	at java.lang.Class.getConstructor0<span class="o">(</span>DynamicHub.java:3585<span class="o">)</span>
	at java.lang.Class.newInstance<span class="o">(</span>DynamicHub.java:626<span class="o">)</span>
	... 6 more
</pre></table></code></div></div><p>If we look at the above error, it’s complaining about some methods not being found. Inorder to understand the reason for the above type of errors we need to understand how native images are created. When creating the native image, the <code class="language-plaintext highlighter-rouge">native-image</code> tool performs static code analysis of the code to determine the classes and methods that should be reachable in the application runtime. At the same time, GraalVM employs different strategies to improve performance. For example, given Class initialization degrades the performance in the runtime, GraalVM does something called <a href="https://www.graalvm.org/22.2/reference-manual/native-image/optimizations-and-performance/ClassInitialization/">Class Initialization In Build time</a> You can read more about these on the official GrallVM website.</p><p>Looking at the above log4j error specifically, GrallVM will have trouble with file descriptors to be referenced in static fields because the files might not be present at run time. Similar issues can occur if Java Reflection is used to load classes in the runtime, native-image will not be able to predict which classes will be needed in the runtime. At this point, you can try to force <code class="language-plaintext highlighter-rouge">native-image</code> tool to pack the classes that are needed when building the image.</p><p>Let’s see how to do this. For this, you can use the <code class="language-plaintext highlighter-rouge">Tracing Agent</code> that comes with GraalVM which allows you to trace the classes being loaded in the application runtime. This agent will allow you to run your application and generate a configuration file that will tell <code class="language-plaintext highlighter-rouge">native-image</code> tool which resources/classes need to be included. The Tracing Agent is capable of detecting usages of the Java Native Interface (JNI), Java Reflection, Dynamic Proxy objects (java.lang.reflect.Proxy), or class path resources (Class.getResource).</p><p>Let’s run the client with the agent using <code class="language-plaintext highlighter-rouge">-agentlib:native-image-agent</code> flag. If you have a server-type application that keeps on running. Once run with the agent you can execute all the options in your application which will load the classes in the runtime and the agent will track them. In my case I have a CLI client which runs and exits, so I had to run the CLI client multiple times with different options that are supported and generate the configurations. One thing to note is if you run the command multiple times with the agent the configurations will be overridden, hence like in my case if you have multiple commands you may want to use multiple output directories for each command and merge the config files later. You can use something like meld to check the diff between files and merge them.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c"># Option 1</span>
java <span class="nt">-agentlib</span>:native-image-agent<span class="o">=</span>config-output-dir<span class="o">=</span>./gral-settings <span class="nt">-jar</span> capp-manager-0.1.3.jar list-apps <span class="nt">--server</span> https://localhost:9443 <span class="nt">--username</span> admin <span class="nt">--password</span> admin

<span class="c"># Option 2</span>
java <span class="nt">-agentlib</span>:native-image-agent<span class="o">=</span>config-output-dir<span class="o">=</span>./gral-settings2 <span class="nt">-jar</span> capp-manager-0.1.3.jar download <span class="nt">--server</span> https://localhost:9443 <span class="nt">--username</span> admin <span class="nt">--password</span> admin <span class="nt">--app-name</span> HelloCompositeExporter <span class="nt">--destination</span> ./
<span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
</pre></table></code></div></div><p>After merging the files you would have multiple configuration files like below. If you see anything missing you can add them manually to each config file.</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>graalvm-settings
├── jni-config.json
├── predefined-classes-config.json
├── proxy-config.json
├── reflect-config.json
├── resource-config.json
└── serialization-config.json
</pre></table></code></div></div><p>Let’s build the new native image with the above config files. Since my application does http/https calls I’m passing some additional flags like <code class="language-plaintext highlighter-rouge">--enable-url-protocols=https,http --enable-https --enable-http</code> if your application doesn’t need them, you can omit them.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>native-image -jar target/capp-manager-0.1.3.jar --no-fallback -H:ConfigurationFileDirectories=./graalvm-settings --enable-url-protocols=https,http --enable-https --enable-http
</pre></table></code></div></div><p>The output</p><div class="language-sh highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre> Top 10 packages <span class="k">in </span>code area:                               Top 10 object types <span class="k">in </span>image heap:
   1.49MB sun.security.ssl                                     5.82MB byte[] <span class="k">for </span>code metadata
   1.04MB java.util                                            2.71MB java.lang.String
 839.46KB picocli                                              2.66MB java.lang.Class
 742.50KB com.sun.org.apache.xalan.internal.xsltc.compiler     2.57MB byte[] <span class="k">for </span>general heap data
 704.42KB com.sun.crypto.provider                              2.04MB byte[] <span class="k">for </span>java.lang.String
 534.36KB java.lang                                          966.80KB com.oracle.svm.core.hub.DynamicHubCompanion
 530.98KB java.lang.invoke                                   900.18KB byte[] <span class="k">for </span>embedded resources
 500.51KB com.sun.org.apache.xerces.internal.impl            639.19KB java.util.HashMap<span class="nv">$Node</span>
 487.96KB c.s.org.apache.xerces.internal.impl.xs.traversers  561.73KB byte[] <span class="k">for </span>reflection metadata
 459.58KB sun.security.x509                                  559.87KB java.lang.String[]
  19.49MB <span class="k">for </span>483 more packages                                4.69MB <span class="k">for </span>2238 more object types
<span class="nt">------------------------------------------------------------------------------------------------------------------------</span>
                        2.0s <span class="o">(</span>4.1% of total <span class="nb">time</span><span class="o">)</span> <span class="k">in </span>31 GCs | Peak RSS: 6.35GB | CPU load: 8.25
<span class="nt">------------------------------------------------------------------------------------------------------------------------</span>
Produced artifacts:
 /home/yasassri/workspace/projects/capp-manager/wso2-capp-manager/capp-manager-0.1.3 <span class="o">(</span>executable<span class="o">)</span>
 /home/yasassri/workspace/projects/capp-manager/wso2-capp-manager/capp-manager-0.1.3.build_artifacts.txt <span class="o">(</span>txt<span class="o">)</span>
<span class="o">========================================================================================================================</span>
Finished generating <span class="s1">'capp-manager-0.1.3'</span> <span class="k">in </span>47.7s.
</pre></table></code></div></div><p>You can see the number of packages that are added to the native image is much higher than in the previous build. The more classes you add to the native image the size of the executable will increase. So you may consider optimizing it after you have successfully built the native image. After the above steps, my application started working without any further errors.</p><p><em>General Tips</em></p><ul><li>Try to use dependencies that are GraalVM compatible. In my case, I migrated from Args4J to Pocoli to build the interactive CLI wchih is compatible with GraalVM.</ul><p>Hope the above helps. Please drop a comment if you have any questions.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/programming/'>Programming</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/graalvm/" class="post-tag no-text-decoration" >GraalVM</a> <a href="/tags/wso2/" class="post-tag no-text-decoration" >wso2</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Converting+Java+CLI+Client+to+a+Native+Executable+with+GraalVM+-+Yasassri+Ratnayake&url=https%3A%2F%2Fyasassri.github.io%2Fposts%2FConvertingJavaClientToANativeExcutableWithGraalVM%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Converting+Java+CLI+Client+to+a+Native+Executable+with+GraalVM+-+Yasassri+Ratnayake&u=https%3A%2F%2Fyasassri.github.io%2Fposts%2FConvertingJavaClientToANativeExcutableWithGraalVM%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fyasassri.github.io%2Fposts%2FConvertingJavaClientToANativeExcutableWithGraalVM%2F&text=Converting+Java+CLI+Client+to+a+Native+Executable+with+GraalVM+-+Yasassri+Ratnayake" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/TrackStateOfIntegrationsInWSO2MI/">Building a Thread-Safe State Tracker Mediator for WSO2</a><li><a href="/posts/OverrridingjavaOptionsInjectedToJavaProcesses/">Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library</a><li><a href="/posts/Delaying-Container-startup-until-a-Kubernetes-resources-are-created/">Delaying Application Startup Until Kubernetes Resources are Created</a><li><a href="/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/">Converting Java CLI Client to a Native Executable with GraalVM</a><li><a href="/posts/Keeping-Your-WSO2-Products-up-to-date-in-a-ContainerisedEnv/">Keeping Your WSO2 Products up-to-date in a Containerised Environment</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/wso2/">wso2</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/cicd/">cicd</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/jenkins/">jenkins</a> <a class="post-tag" href="/tags/wso2/">WSO2</a> <a class="post-tag" href="/tags/wso2mi/">wso2mi</a> <a class="post-tag" href="/tags/groovy/">groovy</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a></div></div></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/AuthorizationHandlerForWSO2MI/"><div class="card-body"> <em class="small" data-ts="1654401600" data-df="ll" > Jun 5, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Role Based Authorization Hanlder for WSO2 Micro Integrator</h3><div class="text-muted small"><p> WSO2 Micro Integrator(MI) is a lightweight integration platform that allows you to write different integrations to connect systems just like an Enterprise Service Bus. If you are familiar with the ...</p></div></div></a></div><div class="card"> <a href="/posts/CustomGithubActionForWSO2APICTL/"><div class="card-body"> <em class="small" data-ts="1664856000" data-df="ll" > Oct 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Custom Github Action for WSO2 APICTL</h3><div class="text-muted small"><p> I have worked with Github Actions in some projects and used quite a few Actions written by others. So I wanted to write my own custom action to experience the process. So here I’m with this post af...</p></div></div></a></div><div class="card"> <a href="/posts/PerfectYourBallerinaActWithTesterina/"><div class="card-body"> <em class="small" data-ts="1525148642" data-df="ll" > May 1, 2018 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Perfect Your Ballerina Act — With Testerina</h3><div class="text-muted small"><p> Designing a Testable Application This post is not about dancing!! Rather it’s about developing a microservice based testable end-to-end application with Ballerina and making sure it runs perfectly...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/StopJenkinsRecurringJobAfterFixedNumberOfExecutions/" class="btn btn-outline-primary" prompt="Older"><p>Stop A Recurring Jenkins Job After a Fixed number of Runs</p></a> <a href="/posts/StoringTDigestsInDatabaseAndRecostructingItBackInJavascript/" class="btn btn-outline-primary" prompt="Newer"><p>Storing TDigests In A Database And Reconstructing It Back In Javascript</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "yasassri/yasassri.github.io", "data-repo-id": "R_kgDOHmz8Lw", "data-category": "comments", "data-category-id": "DIC_kwDOHmz8L84CRzO5", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/yasassri">Yasassri Ratnayake</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/wso2/">wso2</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/cicd/">cicd</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/jenkins/">jenkins</a> <a class="post-tag" href="/tags/wso2/">WSO2</a> <a class="post-tag" href="/tags/wso2mi/">wso2mi</a> <a class="post-tag" href="/tags/groovy/">groovy</a> <a class="post-tag" href="/tags/kubernetes/">Kubernetes</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-0LZHF72L8B"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-0LZHF72L8B'); }); </script>
