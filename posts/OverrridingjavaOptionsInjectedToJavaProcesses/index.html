<!DOCTYPE html><html lang="en" data-mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library" /><meta property="og:locale" content="en" /><meta name="description" content="Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library" /><meta property="og:description" content="Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library" /><link rel="canonical" href="https://yasassri.github.io/posts/OverrridingjavaOptionsInjectedToJavaProcesses/" /><meta property="og:url" content="https://yasassri.github.io/posts/OverrridingjavaOptionsInjectedToJavaProcesses/" /><meta property="og:site_name" content="Yasassri Ratnayake" /><meta property="og:image" content="https://yasassri.github.io/assets/img/posts/kb_dd.png" /><meta property="og:image:height" content="400" /><meta property="og:image:width" content="800" /><meta property="og:image:alt" content="" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-06-22T00:00:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://yasassri.github.io/assets/img/posts/kb_dd.png" /><meta name="twitter:image:alt" content="" /><meta property="twitter:title" content="Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library" /><meta name="twitter:site" content="@yasassrir" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-06-25T22:11:51-04:00","datePublished":"2025-06-22T00:00:00-04:00","description":"Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library","headline":"Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library","image":{"width":800,"height":400,"alt":"","url":"https://yasassri.github.io/assets/img/posts/kb_dd.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yasassri.github.io/posts/OverrridingjavaOptionsInjectedToJavaProcesses/"},"url":"https://yasassri.github.io/posts/OverrridingjavaOptionsInjectedToJavaProcesses/"}</script><title>Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library | Yasassri Ratnayake</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Yasassri Ratnayake"><meta name="application-name" content="Yasassri Ratnayake"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/android-chrome-512x512.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Yasassri Ratnayake</a></div><div class="site-subtitle font-italic">My Personal Web Space</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/otherblogs/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>OTHER BLOGS</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/yasassri" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://stackoverflow.com/users/2627018/ycr" aria-label="stack-overflow" target="_blank" rel="noopener"> <i class="fab fa-stack-overflow"></i> </a> <a href="https://www.linkedin.com/in/yasassriratnayake" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ycrnet','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1750564800" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 22, 2025 </em> </span> <span> Updated <em class="" data-ts="1750903911" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 25, 2025 </em> </span><div class="mt-3 mb-3"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3C/svg%3E" data-src="/assets/img/posts/kb_dd.png" class="preview-img bg" alt="Preview Image" width="800" height="400" data-proofer-ignore><figcaption class="text-center pt-2 pb-2"></figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/yasassri">Yasassri Ratnayake</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1048 words"> <em>5 min</em> read</span></div></div></div><div class="post-content"><h1 id="solving-datadog-java-agent-conflicts-in-kubernetes-with-a-simple-c-library">Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library</h1><p>Recently, I ran into an issue where Datadog’s admission controller was automatically injecting <code class="language-plaintext highlighter-rouge">JAVA_TOOL_OPTIONS</code> into our Java app containers, causing startup issues. This Java app container was executing some other Java commands before the actual app, and the injected <code class="language-plaintext highlighter-rouge">JAVA_TOOL_OPTIONS</code> was causing issues for these other Java runs. In this post, I’ll walk you through how I solved this with a lightweight shared library approach.</p><h2 id="the-problem"><span class="mr-2">The Problem</span><a href="#the-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When you deploy applications in K8s clusters with Datadog monitoring enabled, there are different ways to integrate Datadog. In a Java app, you have to install the Java agent in the container and pass the agent configs to the JVM, typically through the <code class="language-plaintext highlighter-rouge">JAVA_TOOL_OPTIONS</code> environment variable. If you have enabled the Datadog Admission Controller in your cluster, Datadog will use a Mutating Webhook and mutate your pod to inject Datadog dependencies and configs. The Datadog init containers used to just inject the <code class="language-plaintext highlighter-rouge">JAVA_TOOL_OPTIONS</code>, which was available to you in the container runtime. In other words, if you <code class="language-plaintext highlighter-rouge">exec</code> into a pod and <code class="language-plaintext highlighter-rouge">echo $JAVA_TOOL_OPTIONS</code>, you should see the variable. So if you needed, you had the capability to unset this if you didn’t want it passed to certain operations happening on container startup. But with the latest Datadog versions, they took it to another level, where the Datadog init container now injects a Linux shared library and sets their library in <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code> to inject this variable, which made it impossible to remove from environment variables using traditional methods. Shared libraries can be either passed through the <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> variable or by setting the library in <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code>.</p><h3 id="what-are-shared-libraries-aka-ld_preload"><span class="mr-2">What are shared libraries, AKA LD_PRELOAD?</span><a href="#what-are-shared-libraries-aka-ld_preload" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Before diving in further, let me explain what <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> does. It’s a Linux feature that allows you to load shared libraries before any other libraries when a program starts. This means:</p><ol><li><strong>Library Loading Order</strong>: Libraries specified in <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> are loaded first.<li><strong>Function Overriding</strong>: You can override functions from other libraries.<li><strong>Early Execution</strong>: Constructor functions in preloaded libraries run before the main application starts.</ol><p>The difference between <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> and <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code>:</p><ul><li><strong>LD_PRELOAD</strong>: Environment variable, affects only the current process.<li><strong>/etc/ld.so.preload</strong>: System-wide file, affects all processes.</ul><h2 id="solution-fight-fire-with-fire"><span class="mr-2">Solution: Fight Fire with Fire!</span><a href="#solution-fight-fire-with-fire" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Instead of fighting with Kubernetes configurations or changing application code, I decided to create my own shared library that automatically unsets the problematic <code class="language-plaintext highlighter-rouge">JAVA_TOOL_OPTIONS</code> environment variable. The key was understanding how <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> works and using it to my advantage. Since Datadog was using <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code>, their library was loading system-wide. But by using <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code>, I could ensure my library loads after Datadog’s but before the Java application starts.</p><h3 id="the-solution"><span class="mr-2">The Solution</span><a href="#the-solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The implementation is surprisingly simple—just 12 lines of C code that uses the GNU C library’s constructor attribute:</p><div class="language-c highlighter-rouge"><div class="code-header"> <span data-label-text="C"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="cp">#define _GNU_SOURCE
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span>
<span class="n">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">))</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">unset_java_tool_options</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">getenv</span><span class="p">(</span><span class="s">"JAVA_TOOL_OPTIONS"</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">unsetenv</span><span class="p">(</span><span class="s">"JAVA_TOOL_OPTIONS"</span><span class="p">);</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"JAVA_TOOL_OPTIONS has been unset.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The magic happens with the <code class="language-plaintext highlighter-rouge">__attribute__((constructor))</code> directive—this ensures the function runs automatically when the shared library is loaded. Here’s the execution order:</p><ol><li><strong>System starts the Java process</strong><li><strong>Datadog’s library loads</strong> (from <code class="language-plaintext highlighter-rouge">/etc/ld.so.preload</code>) and sets <code class="language-plaintext highlighter-rouge">JAVA_TOOL_OPTIONS</code>.<li><strong>My library loads</strong> (from <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code>) and unsets <code class="language-plaintext highlighter-rouge">JAVA_TOOL_OPTIONS</code>.<li><strong>Java application starts</strong> with the variable unset.</ol><p>This way, I’m essentially running my unset script after Datadog runs its script, but before the Java process is initialized.</p><h2 id="building-the-library"><span class="mr-2">Building the Library</span><a href="#building-the-library" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>If you just want to use the compiled library, you can locate the source code and a compiled artifact here: https://github.com/yasassri/shared-lib/actions/runs/15891248186</p><p>When building the library, you need to make sure the library is compatible with the environment. In my case, I needed to compile this for our production environment which runs on x86_64 Linux. Here’s how you can build it:</p><h3 id="local-compilation-linux-x86_64"><span class="mr-2">Local Compilation (Linux x86_64)</span><a href="#local-compilation-linux-x86_64" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>gcc <span class="nt">-shared</span> <span class="nt">-fPIC</span> <span class="nt">-o</span> unset_java_tool_options.so unset_java_tool_options.c
</pre></table></code></div></div><h3 id="cross-platform-compilation-with-docker"><span class="mr-2">Cross-platform Compilation with Docker</span><a href="#cross-platform-compilation-with-docker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Since I was working on a Mac with Apple Silicon, I used Docker to ensure I got the right architecture. The key option here is <code class="language-plaintext highlighter-rouge">--platform linux/amd64</code>. This approach works great for anyone not on Linux:</p><p><strong>For Mac users:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>docker run <span class="nt">--platform</span> linux/amd64 <span class="nt">--rm</span> <span class="nt">-v</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">"</span>:/src ubuntu:20.04 sh <span class="nt">-c</span> <span class="se">\</span>
  <span class="s2">"apt-get update &amp;&amp; apt-get install -y gcc &amp;&amp; cd /src &amp;&amp; </span><span class="se">\</span><span class="s2">
   gcc -shared -fPIC -o unset_java_tool_options.so unset_java_tool_options.c"</span>
</pre></table></code></div></div><p><strong>For Linux users:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>docker run <span class="nt">--rm</span> <span class="nt">-v</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span><span class="s2">"</span>:/src ubuntu:20.04 sh <span class="nt">-c</span> <span class="se">\</span>
  <span class="s2">"apt-get update &amp;&amp; apt-get install -y gcc &amp;&amp; cd /src &amp;&amp; </span><span class="se">\</span><span class="s2">
   gcc -shared -fPIC -o unset_java_tool_options.so unset_java_tool_options.c"</span>
</pre></table></code></div></div><p>I chose this Docker approach because it:</p><ul><li>Uses Ubuntu 20.04 to match our container base images.<li>Targets x86_64 architecture for production compatibility.<li>Gives me a consistent build environment regardless of my local machine.</ul><h2 id="using-it-in-production"><span class="mr-2">Using It In Production</span><a href="#using-it-in-production" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The key is using <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> to load our library for the specific process:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">LD_PRELOAD</span><span class="o">=</span>./unset_java_tool_options.so java <span class="nt">-jar</span> your-application.jar
</pre></table></code></div></div><p>This approach works because:</p><ul><li>Datadog’s system-wide library sets the variable.<li>Our process-specific library unsets it.<li>The Java application gets a clean environment.</ul><h3 id="container-integration"><span class="mr-2">Container Integration</span><a href="#container-integration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In our Dockerfile, I integrated it like this:</p><div class="language-dockerfile highlighter-rouge"><div class="code-header"> <span data-label-text="Dockerfile"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># Copy the shared library</span>
<span class="k">COPY</span><span class="s"> shared-libs/unset_java_tool_options.so /opt/app/</span>
</pre></table></code></div></div><p>You can simply COPY this to your Docker base image and use it whenever you need it. Also note: if you set this globally, Datadog will never run, even for the intended processes.</p><h2 id="why-this-approach-works-well"><span class="mr-2">Why This Approach Works Well</span><a href="#why-this-approach-works-well" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I really like this solution because it’s:</p><ol><li><strong>Non-invasive</strong>: No changes needed to our application code.<li><strong>Automatic</strong>: Works transparently at runtime.<li><strong>Lightweight</strong>: Minimal overhead with a tiny shared library.<li><strong>Flexible</strong>: Can easily enable or disable by changing the <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> variable.</ol><h2 id="architecture-notes"><span class="mr-2">Architecture Notes</span><a href="#architecture-notes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>I compiled this specifically for x86_64 architecture because:</p><ul><li>Our production K8s clusters run on x86_64 nodes.<li>WSO2 containers typically use x86_64 base images.<li>Cross-compilation ensures compatibility regardless of where I’m developing.</ul><h2 id="when-id-use-this-solution"><span class="mr-2">When I’d Use This Solution</span><a href="#when-id-use-this-solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This approach is perfect when:</p><ul><li>You need to disable Datadog’s automatic Java agent injection for specific processes within your container.<li>Legacy applications have compatibility issues with the injected agent.</ul><h2 id="wrapping-up"><span class="mr-2">Wrapping Up</span><a href="#wrapping-up" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This simple shared library shows how a well-targeted solution can solve complex environment conflicts in containerized applications. By using the <code class="language-plaintext highlighter-rouge">LD_PRELOAD</code> mechanism and constructor functions, I was able to cleanly intercept and modify the runtime environment without touching any application code.</p><p>If you’re facing similar environment variable conflicts with Java applications, give this approach a try. Drop a comment if you have any thoughts or questions.</p><hr /></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/kubernetes/'>Kubernetes</a>, <a href='/categories/datadog/'>Datadog</a>, <a href='/categories/java/'>Java</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >Kubernetes</a> <a href="/tags/wso2/" class="post-tag no-text-decoration" >WSO2</a> <a href="/tags/datadog/" class="post-tag no-text-decoration" >Datadog</a> <a href="/tags/java/" class="post-tag no-text-decoration" >Java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Solving+Datadog+Java+Agent+Conflicts+in+Kubernetes+With+A+Simple+C+Library+-+Yasassri+Ratnayake&url=https%3A%2F%2Fyasassri.github.io%2Fposts%2FOverrridingjavaOptionsInjectedToJavaProcesses%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Solving+Datadog+Java+Agent+Conflicts+in+Kubernetes+With+A+Simple+C+Library+-+Yasassri+Ratnayake&u=https%3A%2F%2Fyasassri.github.io%2Fposts%2FOverrridingjavaOptionsInjectedToJavaProcesses%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fyasassri.github.io%2Fposts%2FOverrridingjavaOptionsInjectedToJavaProcesses%2F&text=Solving+Datadog+Java+Agent+Conflicts+in+Kubernetes+With+A+Simple+C+Library+-+Yasassri+Ratnayake" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/OverrridingjavaOptionsInjectedToJavaProcesses/">Solving Datadog Java Agent Conflicts in Kubernetes With A Simple C Library</a><li><a href="/posts/Delaying-Container-startup-until-a-Kubernetes-resources-are-created/">Delaying Application Startup Until Kubernetes Resources are Created</a><li><a href="/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/">Converting Java CLI Client to a Native Executable with GraalVM</a><li><a href="/posts/Keeping-Your-WSO2-Products-up-to-date-in-a-ContainerisedEnv/">Keeping Your WSO2 Products up-to-date in a Containerised Environment</a><li><a href="/posts/CreateJenkinsCredentialsThroughRestAPI/">Create Jenkins Credentials Through Rest API</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/wso2/">wso2</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/cicd/">cicd</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/jenkins/">jenkins</a> <a class="post-tag" href="/tags/wso2mi/">wso2mi</a> <a class="post-tag" href="/tags/groovy/">groovy</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/wso2ei/">wso2ei</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Delaying-Container-startup-until-a-Kubernetes-resources-are-created/"><div class="card-body"> <em class="small" data-ts="1715745600" data-df="ll" > May 15, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Delaying Application Startup Until Kubernetes Resources are Created</h3><div class="text-muted small"><p> In this post, I will take you through the process I followed when trying to debug an issue that was occurring in one of the applications deployed in K8S. If you are just interested in the part ment...</p></div></div></a></div><div class="card"> <a href="/posts/StoringTDigestsInDatabaseAndRecostructingItBackInJavascript/"><div class="card-body"> <em class="small" data-ts="1694750400" data-df="ll" > Sep 15, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Storing TDigests In A Database And Reconstructing It Back In Javascript</h3><div class="text-muted small"><p> T-Digest is a statistical algorithm used for approximate calculation of quantiles and percentiles from large data sets. It’s particularly useful when you have a vast amount of data and you want to ...</p></div></div></a></div><div class="card"> <a href="/posts/ConvertingJavaClientToANativeExcutableWithGraalVM/"><div class="card-body"> <em class="small" data-ts="1665892800" data-df="ll" > Oct 16, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Converting Java CLI Client to a Native Executable with GraalVM</h3><div class="text-muted small"><p> GraalVM is a high-performance JDK distribution designed to accelerate the execution of applications written in Java and other JVM languages along with support for JavaScript, Ruby, Python, and a nu...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Delaying-Container-startup-until-a-Kubernetes-resources-are-created/" class="btn btn-outline-primary" prompt="Older"><p>Delaying Application Startup Until Kubernetes Resources are Created</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "yasassri/yasassri.github.io", "data-repo-id": "R_kgDOHmz8Lw", "data-category": "comments", "data-category-id": "DIC_kwDOHmz8L84CRzO5", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/yasassri">Yasassri Ratnayake</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/wso2/">wso2</a> <a class="post-tag" href="/tags/automation/">automation</a> <a class="post-tag" href="/tags/cicd/">cicd</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/jenkins/">jenkins</a> <a class="post-tag" href="/tags/wso2mi/">wso2mi</a> <a class="post-tag" href="/tags/groovy/">groovy</a> <a class="post-tag" href="/tags/testing/">testing</a> <a class="post-tag" href="/tags/wso2ei/">wso2ei</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-0LZHF72L8B"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-0LZHF72L8B'); }); </script>
